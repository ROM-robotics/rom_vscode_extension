"use strict";var T=Object.create;var v=Object.defineProperty;var R=Object.getOwnPropertyDescriptor;var k=Object.getOwnPropertyNames;var x=Object.getPrototypeOf,H=Object.prototype.hasOwnProperty;var W=(s,t)=>{for(var e in t)v(s,e,{get:t[e],enumerable:!0})},C=(s,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of k(t))!H.call(s,n)&&n!==e&&v(s,n,{get:()=>t[n],enumerable:!(r=R(t,n))||r.enumerable});return s};var $=(s,t,e)=>(e=s!=null?T(x(s)):{},C(t||!s||!s.__esModule?v(e,"default",{value:s,enumerable:!0}):e,s)),L=s=>C(v({},"__esModule",{value:!0}),s);var D={};W(D,{activate:()=>B,deactivate:()=>A});module.exports=L(D);var o=$(require("vscode")),P=require("child_process"),S=$(require("fs"));async function b(s,t,e){let r=o.workspace.getConfiguration("robotCodeSync"),n=r.get(s,""),p=r.get(t,""),h=r.get("robotHost","robot@192.168.1.100"),g=r.get("robotPassword",""),y=r.get("excludePatterns",[".git","node_modules"]);if(!S.existsSync(n)){o.window.showErrorMessage(`Source path does not exist: ${n}`);return}if(await o.window.showInformationMessage(`Sync ${e}
From: ${n}
To: ${h}:${p}`,"Yes","No")!=="Yes")return;n.endsWith("/")||(n+="/");let w=y.map(c=>`--exclude='${c}'`).join(" "),i;g?i=`sshpass -p '${g}' rsync -avz --delete ${w} "${n}" ${h}:"${p}"`:i=`rsync -avz --delete ${w} "${n}" ${h}:"${p}"`,o.window.withProgress({location:o.ProgressLocation.Notification,title:`Syncing ${e} to robot...`,cancellable:!1},async c=>new Promise((a,d)=>{(0,P.exec)(i,{maxBuffer:1024*1024*10},(m,l,f)=>{if(m){o.window.showErrorMessage(`Sync failed: ${m.message}`);let u=o.window.createOutputChannel("Robot Code Sync");u.appendLine("Error:"),u.appendLine(m.message),f&&(u.appendLine(`
Stderr:`),u.appendLine(f)),u.appendLine(`
Command:`),u.appendLine(i.replace(g,"***")),u.show(),d(m);return}if(o.window.showInformationMessage(`\u2705 ${e} synced to robot successfully!`),l){let u=o.window.createOutputChannel("Robot Code Sync");u.appendLine(`Sync completed for ${e}:`),u.appendLine(l)}a()})}))}function B(s){console.log("Robot Code Sync extension is now active!");let t=o.window.createStatusBarItem(o.StatusBarAlignment.Right,100);t.command="robot-code-sync.syncNav2WsToRobot",t.text="$(cloud-upload) Sync to Robot",t.tooltip="Click to sync code to robot",o.workspace.getConfiguration("robotCodeSync").get("showStatusBar",!0)&&t.show(),s.subscriptions.push(t),s.subscriptions.push(o.commands.registerCommand("robot-code-sync.syncNav2WsToRobot",()=>b("rom_nav2_ws_sourcePath","rom_nav2_ws_destinationPath","nav2_ws"))),s.subscriptions.push(o.commands.registerCommand("robot-code-sync.syncDataToRobot",()=>b("data_sourcePath","data_destinationPath","~/data"))),s.subscriptions.push(o.commands.registerCommand("robot-code-sync.syncMytmuxToRobot",()=>b("mytmux_sourcePath","mytmux_destinationPath","mytmux"))),s.subscriptions.push(o.commands.registerCommand("robot-code-sync.syncSdkWsToRobot",()=>b("rom_sdk_ws_sourcePath","rom_sdk_ws_destinationPath","rom_sdk_ws"))),s.subscriptions.push(o.commands.registerCommand("robot-code-sync.syncDriversWsToRobot",()=>b("rom_drivers_ws_sourcePath","rom_drivers_ws_destinationPath","rom_drivers_ws"))),s.subscriptions.push(o.commands.registerCommand("robot-code-sync.syncThirdpartyDriversWsToRobot",()=>b("thirdparty_drivers_ws_sourcePath","thirdparty_drivers_ws_destinationPath","thirdparty_drivers_ws"))),s.subscriptions.push(o.commands.registerCommand("robot-code-sync.syncAllToRobot",()=>b("all_sourcePath","all_destinationPath","All")));let r=(i,c)=>o.commands.registerCommand(`robot-code-sync.build${i}`,async()=>{let a=o.workspace.getConfiguration("robotCodeSync"),d=a.get("robotHost","robot@192.168.1.100"),m=a.get("robotPassword",""),l=o.window.createTerminal({name:`Build ${c}`,shellPath:"/bin/bash"});m?l.sendText(`sshpass -p '${m}' ssh -t ${d} "cd ~/${c} && colcon build"`):l.sendText(`ssh -t ${d} "cd ~/${c} && colcon build"`),l.show()}),n=r("RomSdkWs","rom_sdk_ws"),p=r("RomNav2Ws","rom_nav2_ws"),h=r("RomDriversWs","rom_drivers_ws"),g=r("ThirdpartyDriversWs","thirdparty_drivers_ws"),y=o.commands.registerCommand("robot-code-sync.buildAll",async()=>{let i=o.workspace.getConfiguration("robotCodeSync"),c=i.get("robotHost","robot@192.168.1.100"),a=i.get("robotPassword",""),d=o.window.createTerminal({name:"Build All",shellPath:"/bin/bash"}),m="cd ~/rom_sdk_ws && colcon build && cd ~/rom_drivers_ws && colcon build && cd ~/rom_nav2_ws && colcon build";a?d.sendText(`sshpass -p '${a}' ssh -t ${c} "${m}"`):d.sendText(`ssh -t ${c} "${m}"`),d.show()}),_=o.commands.registerCommand("robot-code-sync.openSSH",async()=>{let i=o.workspace.getConfiguration("robotCodeSync"),c=i.get("robotHost","robot@192.168.1.100"),a=i.get("robotPassword",""),d=o.window.createTerminal({name:`SSH: ${c}`,shellPath:"/bin/bash"});a?d.sendText(`sshpass -p '${a}' ssh ${c}`):d.sendText(`ssh ${c}`),d.show()}),w=o.commands.registerCommand("robot-code-sync.openSettings",()=>{o.commands.executeCommand("workbench.action.openSettings","@ext:rom-robotics-llc.robot-code-sync")});s.subscriptions.push(n),s.subscriptions.push(p),s.subscriptions.push(h),s.subscriptions.push(g),s.subscriptions.push(y),s.subscriptions.push(_),s.subscriptions.push(w)}function A(){}0&&(module.exports={activate,deactivate});
