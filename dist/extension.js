"use strict";var T=Object.create;var y=Object.defineProperty;var x=Object.getOwnPropertyDescriptor;var A=Object.getOwnPropertyNames;var R=Object.getPrototypeOf,k=Object.prototype.hasOwnProperty;var I=(s,e)=>{for(var d in e)y(s,d,{get:e[d],enumerable:!0})},$=(s,e,d,m)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of A(e))!k.call(s,i)&&i!==d&&y(s,i,{get:()=>e[i],enumerable:!(m=x(e,i))||m.enumerable});return s};var P=(s,e,d)=>(d=s!=null?T(R(s)):{},$(e||!s||!s.__esModule?y(d,"default",{value:s,enumerable:!0}):d,s)),H=s=>$(y({},"__esModule",{value:!0}),s);var L={};I(L,{activate:()=>M,deactivate:()=>W});module.exports=H(L);var o=P(require("vscode")),S=require("child_process"),_=P(require("fs"));async function p(s,e,d){let m=o.workspace.getConfiguration("robotCodeSync"),i=m.get(s,""),g=m.get(e,""),h=m.get("robotHost","robot@192.168.1.100"),l=m.get("robotPassword",""),f=m.get("excludePatterns",[".git","node_modules"]);if(!_.existsSync(i)){o.window.showErrorMessage(`Source path does not exist: ${i}`);return}if(await o.window.showInformationMessage(`Sync ${d}
From: ${i}
To: ${h}:${g}`,"Yes","No")!=="Yes")return;i.endsWith("/")||(i+="/");let w=f.map(v=>`--exclude='${v}'`).join(" "),b;l?b=`sshpass -p '${l}' rsync -avz --delete ${w} "${i}" ${h}:"${g}"`:b=`rsync -avz --delete ${w} "${i}" ${h}:"${g}"`,o.window.withProgress({location:o.ProgressLocation.Notification,title:`Syncing ${d} to robot...`,cancellable:!1},async v=>new Promise((a,n)=>{(0,S.exec)(b,{maxBuffer:1024*1024*10},(t,c,u)=>{if(t){o.window.showErrorMessage(`Sync failed: ${t.message}`);let r=o.window.createOutputChannel("Robot Code Sync");r.appendLine("Error:"),r.appendLine(t.message),u&&(r.appendLine(`
Stderr:`),r.appendLine(u)),r.appendLine(`
Command:`),r.appendLine(b.replace(l,"***")),r.show(),n(t);return}if(o.window.showInformationMessage(`\u2705 ${d} synced to robot successfully!`),c){let r=o.window.createOutputChannel("Robot Code Sync");r.appendLine(`Sync completed for ${d}:`),r.appendLine(c)}a()})}))}function M(s){console.log("Robot Code Sync extension is now active!");let e=o.window.createStatusBarItem(o.StatusBarAlignment.Right,100);e.command="robot-code-sync.syncNav2WsToRobot",e.text="$(cloud-upload) Sync to Robot",e.tooltip="Click to sync code to robot",o.workspace.getConfiguration("robotCodeSync").get("showStatusBar",!0)&&e.show(),s.subscriptions.push(e),s.subscriptions.push(o.commands.registerCommand("robot-code-sync.syncNav2WsToRobot",()=>p("rom_nav2_ws_sourcePath","rom_nav2_ws_destinationPath","nav2_ws"))),s.subscriptions.push(o.commands.registerCommand("robot-code-sync.syncDataToRobot",()=>p("data_sourcePath","data_destinationPath","~/data"))),s.subscriptions.push(o.commands.registerCommand("robot-code-sync.syncMytmuxToRobot",()=>p("mytmux_sourcePath","mytmux_destinationPath","mytmux"))),s.subscriptions.push(o.commands.registerCommand("robot-code-sync.syncSdkWsToRobot",()=>p("rom_sdk_ws_sourcePath","rom_sdk_ws_destinationPath","rom_sdk_ws"))),s.subscriptions.push(o.commands.registerCommand("robot-code-sync.syncDriversWsToRobot",()=>p("rom_drivers_ws_sourcePath","rom_drivers_ws_destinationPath","rom_drivers_ws"))),s.subscriptions.push(o.commands.registerCommand("robot-code-sync.syncThirdpartyDriversWsToRobot",()=>p("thirdparty_drivers_ws_sourcePath","thirdparty_drivers_ws_destinationPath","thirdparty_drivers_ws"))),s.subscriptions.push(o.commands.registerCommand("robot-code-sync.syncAllToRobot",()=>p("all_sourcePath","all_destinationPath","All")));let m=(a,n)=>o.commands.registerCommand(`robot-code-sync.build${a}`,async()=>{let t=o.workspace.getConfiguration("robotCodeSync"),c=t.get("robotHost","robot@192.168.1.100"),u=t.get("robotPassword",""),r=o.window.createTerminal({name:`Build ${n}`,shellPath:"/bin/bash"});u?r.sendText(`sshpass -p '${u}' ssh -t ${c} "cd ~/${n} && colcon build"`):r.sendText(`ssh -t ${c} "cd ~/${n} && colcon build"`),r.show()}),i=m("RomSdkWs","rom_sdk_ws"),g=m("RomNav2Ws","rom_nav2_ws"),h=m("RomDriversWs","rom_drivers_ws"),l=m("ThirdpartyDriversWs","thirdparty_drivers_ws"),f=o.commands.registerCommand("robot-code-sync.buildAll",async()=>{let a=o.workspace.getConfiguration("robotCodeSync"),n=a.get("robotHost","robot@192.168.1.100"),t=a.get("robotPassword",""),c=o.window.createTerminal({name:"Build All",shellPath:"/bin/bash"}),u="cd ~/rom_sdk_ws && colcon build && cd ~/rom_drivers_ws && colcon build && cd ~/rom_nav2_ws && colcon build";t?c.sendText(`sshpass -p '${t}' ssh -t ${n} "${u}"`):c.sendText(`ssh -t ${n} "${u}"`),c.show()}),C=o.commands.registerCommand("robot-code-sync.runGui",async()=>{let n=o.workspace.getConfiguration("robotCodeSync").get("appImagePath","/home/mr_robot/Desktop/Git/rom_robotics/data/app/rom_dynamics_multi_robots_gui-linux-linux-v0.0.1.AppImage");if(!_.existsSync(n)){o.window.showErrorMessage(`AppImage not found: ${n}`);return}let t=o.window.createTerminal({name:"ROM GUI",shellPath:"/bin/bash"});t.sendText(`chmod +x "${n}" && "${n}"`),t.show(),o.window.showInformationMessage("ROM GUI launched!")}),w=o.commands.registerCommand("robot-code-sync.runTuningApp",async()=>{let a=o.workspace.getConfiguration("robotCodeSync"),n=a.get("tuningAppPath","/home/mr_robot/data/app/tuning_app-linux-linux-v0.0.1.AppImage"),t=a.get("robotHost","robot@192.168.1.100"),c=a.get("robotPassword","");if(!_.existsSync(n)){o.window.showErrorMessage(`Tuning App not found: ${n}`);return}let u=t.includes("@")?t.split("@")[1]:t,r=o.window.createTerminal({name:"Tuning App",shellPath:"/bin/bash"});r.sendText(`chmod +x "${n}" && "${n}" -i ${u} -p "${c}"`),r.show(),o.window.showInformationMessage("Tuning App launched!")}),b=o.commands.registerCommand("robot-code-sync.openSSH",async()=>{let a=o.workspace.getConfiguration("robotCodeSync"),n=a.get("robotHost","robot@192.168.1.100"),t=a.get("robotPassword",""),c=o.window.createTerminal({name:`SSH: ${n}`,shellPath:"/bin/bash"});t?c.sendText(`sshpass -p '${t}' ssh ${n}`):c.sendText(`ssh ${n}`),c.show()}),v=o.commands.registerCommand("robot-code-sync.openSettings",()=>{o.commands.executeCommand("workbench.action.openSettings","@ext:rom-robotics-llc.robot-code-sync")});s.subscriptions.push(i),s.subscriptions.push(g),s.subscriptions.push(h),s.subscriptions.push(l),s.subscriptions.push(f),s.subscriptions.push(C),s.subscriptions.push(w),s.subscriptions.push(b),s.subscriptions.push(v)}function W(){}0&&(module.exports={activate,deactivate});
