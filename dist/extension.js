"use strict";var T=Object.create;var y=Object.defineProperty;var R=Object.getOwnPropertyDescriptor;var x=Object.getOwnPropertyNames;var k=Object.getPrototypeOf,I=Object.prototype.hasOwnProperty;var H=(s,t)=>{for(var i in t)y(s,i,{get:t[i],enumerable:!0})},$=(s,t,i,c)=>{if(t&&typeof t=="object"||typeof t=="function")for(let e of x(t))!I.call(s,e)&&e!==i&&y(s,e,{get:()=>t[e],enumerable:!(c=R(t,e))||c.enumerable});return s};var P=(s,t,i)=>(i=s!=null?T(k(s)):{},$(t||!s||!s.__esModule?y(i,"default",{value:s,enumerable:!0}):i,s)),W=s=>$(y({},"__esModule",{value:!0}),s);var M={};H(M,{activate:()=>A,deactivate:()=>L});module.exports=W(M);var o=P(require("vscode")),S=require("child_process"),f=P(require("fs"));async function b(s,t,i){let c=o.workspace.getConfiguration("robotCodeSync"),e=c.get(s,""),h=c.get(t,""),g=c.get("robotHost","robot@192.168.1.100"),w=c.get("robotPassword",""),_=c.get("excludePatterns",[".git","node_modules"]);if(!f.existsSync(e)){o.window.showErrorMessage(`Source path does not exist: ${e}`);return}if(await o.window.showInformationMessage(`Sync ${i}
From: ${e}
To: ${g}:${h}`,"Yes","No")!=="Yes")return;e.endsWith("/")||(e+="/");let v=_.map(a=>`--exclude='${a}'`).join(" "),p;w?p=`sshpass -p '${w}' rsync -avz --delete ${v} "${e}" ${g}:"${h}"`:p=`rsync -avz --delete ${v} "${e}" ${g}:"${h}"`,o.window.withProgress({location:o.ProgressLocation.Notification,title:`Syncing ${i} to robot...`,cancellable:!1},async a=>new Promise((n,d)=>{(0,S.exec)(p,{maxBuffer:1024*1024*10},(r,u,l)=>{if(r){o.window.showErrorMessage(`Sync failed: ${r.message}`);let m=o.window.createOutputChannel("Robot Code Sync");m.appendLine("Error:"),m.appendLine(r.message),l&&(m.appendLine(`
Stderr:`),m.appendLine(l)),m.appendLine(`
Command:`),m.appendLine(p.replace(w,"***")),m.show(),d(r);return}if(o.window.showInformationMessage(`\u2705 ${i} synced to robot successfully!`),u){let m=o.window.createOutputChannel("Robot Code Sync");m.appendLine(`Sync completed for ${i}:`),m.appendLine(u)}n()})}))}function A(s){console.log("Robot Code Sync extension is now active!");let t=o.window.createStatusBarItem(o.StatusBarAlignment.Right,100);t.command="robot-code-sync.syncNav2WsToRobot",t.text="$(cloud-upload) Sync to Robot",t.tooltip="Click to sync code to robot",o.workspace.getConfiguration("robotCodeSync").get("showStatusBar",!0)&&t.show(),s.subscriptions.push(t),s.subscriptions.push(o.commands.registerCommand("robot-code-sync.syncNav2WsToRobot",()=>b("rom_nav2_ws_sourcePath","rom_nav2_ws_destinationPath","nav2_ws"))),s.subscriptions.push(o.commands.registerCommand("robot-code-sync.syncDataToRobot",()=>b("data_sourcePath","data_destinationPath","~/data"))),s.subscriptions.push(o.commands.registerCommand("robot-code-sync.syncMytmuxToRobot",()=>b("mytmux_sourcePath","mytmux_destinationPath","mytmux"))),s.subscriptions.push(o.commands.registerCommand("robot-code-sync.syncSdkWsToRobot",()=>b("rom_sdk_ws_sourcePath","rom_sdk_ws_destinationPath","rom_sdk_ws"))),s.subscriptions.push(o.commands.registerCommand("robot-code-sync.syncDriversWsToRobot",()=>b("rom_drivers_ws_sourcePath","rom_drivers_ws_destinationPath","rom_drivers_ws"))),s.subscriptions.push(o.commands.registerCommand("robot-code-sync.syncThirdpartyDriversWsToRobot",()=>b("thirdparty_drivers_ws_sourcePath","thirdparty_drivers_ws_destinationPath","thirdparty_drivers_ws"))),s.subscriptions.push(o.commands.registerCommand("robot-code-sync.syncAllToRobot",()=>b("all_sourcePath","all_destinationPath","All")));let c=(a,n)=>o.commands.registerCommand(`robot-code-sync.build${a}`,async()=>{let d=o.workspace.getConfiguration("robotCodeSync"),r=d.get("robotHost","robot@192.168.1.100"),u=d.get("robotPassword",""),l=o.window.createTerminal({name:`Build ${n}`,shellPath:"/bin/bash"});u?l.sendText(`sshpass -p '${u}' ssh -t ${r} "cd ~/${n} && colcon build"`):l.sendText(`ssh -t ${r} "cd ~/${n} && colcon build"`),l.show()}),e=c("RomSdkWs","rom_sdk_ws"),h=c("RomNav2Ws","rom_nav2_ws"),g=c("RomDriversWs","rom_drivers_ws"),w=c("ThirdpartyDriversWs","thirdparty_drivers_ws"),_=o.commands.registerCommand("robot-code-sync.buildAll",async()=>{let a=o.workspace.getConfiguration("robotCodeSync"),n=a.get("robotHost","robot@192.168.1.100"),d=a.get("robotPassword",""),r=o.window.createTerminal({name:"Build All",shellPath:"/bin/bash"}),u="cd ~/rom_sdk_ws && colcon build && cd ~/rom_drivers_ws && colcon build && cd ~/rom_nav2_ws && colcon build";d?r.sendText(`sshpass -p '${d}' ssh -t ${n} "${u}"`):r.sendText(`ssh -t ${n} "${u}"`),r.show()}),C=o.commands.registerCommand("robot-code-sync.runGui",async()=>{let n=o.workspace.getConfiguration("robotCodeSync").get("appImagePath","/home/mr_robot/Desktop/Git/rom_robotics/data/app/rom_dynamics_multi_robots_gui-linux-linux-v0.0.1.AppImage");if(!f.existsSync(n)){o.window.showErrorMessage(`AppImage not found: ${n}`);return}let d=o.window.createTerminal({name:"ROM GUI",shellPath:"/bin/bash"});d.sendText(`chmod +x "${n}" && "${n}"`),d.show(),o.window.showInformationMessage("ROM GUI launched!")}),v=o.commands.registerCommand("robot-code-sync.openSSH",async()=>{let a=o.workspace.getConfiguration("robotCodeSync"),n=a.get("robotHost","robot@192.168.1.100"),d=a.get("robotPassword",""),r=o.window.createTerminal({name:`SSH: ${n}`,shellPath:"/bin/bash"});d?r.sendText(`sshpass -p '${d}' ssh ${n}`):r.sendText(`ssh ${n}`),r.show()}),p=o.commands.registerCommand("robot-code-sync.openSettings",()=>{o.commands.executeCommand("workbench.action.openSettings","@ext:rom-robotics-llc.robot-code-sync")});s.subscriptions.push(e),s.subscriptions.push(h),s.subscriptions.push(g),s.subscriptions.push(w),s.subscriptions.push(_),s.subscriptions.push(C),s.subscriptions.push(v),s.subscriptions.push(p)}function L(){}0&&(module.exports={activate,deactivate});
