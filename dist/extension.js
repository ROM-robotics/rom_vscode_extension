"use strict";var T=Object.create;var w=Object.defineProperty;var R=Object.getOwnPropertyDescriptor;var x=Object.getOwnPropertyNames;var k=Object.getPrototypeOf,W=Object.prototype.hasOwnProperty;var L=(s,t)=>{for(var e in t)w(s,e,{get:t[e],enumerable:!0})},C=(s,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of x(t))!W.call(s,n)&&n!==e&&w(s,n,{get:()=>t[n],enumerable:!(r=R(t,n))||r.enumerable});return s};var $=(s,t,e)=>(e=s!=null?T(k(s)):{},C(t||!s||!s.__esModule?w(e,"default",{value:s,enumerable:!0}):e,s)),H=s=>C(w({},"__esModule",{value:!0}),s);var M={};L(M,{activate:()=>B,deactivate:()=>D});module.exports=H(M);var o=$(require("vscode")),P=require("child_process"),S=$(require("fs"));async function b(s,t,e){let r=o.workspace.getConfiguration("robotCodeSync"),n=r.get(s,""),p=r.get(t,""),h=r.get("robotHost","robot@192.168.1.100"),g=r.get("robotPassword",""),v=r.get("excludePatterns",[".git","node_modules"]);if(!S.existsSync(n)){o.window.showErrorMessage(`Source path does not exist: ${n}`);return}if(await o.window.showInformationMessage(`Sync ${e}
From: ${n}
To: ${h}:${p}`,"Yes","No")!=="Yes")return;n.endsWith("/")||(n+="/");let u=v.map(d=>`--exclude='${d}'`).join(" "),i;g?i=`sshpass -p '${g}' rsync -avz --delete ${u} "${n}" ${h}:"${p}"`:i=`rsync -avz --delete ${u} "${n}" ${h}:"${p}"`,o.window.withProgress({location:o.ProgressLocation.Notification,title:`Syncing ${e} to robot...`,cancellable:!1},async d=>new Promise((a,l)=>{(0,P.exec)(i,{maxBuffer:1024*1024*10},(m,_,f)=>{if(m){o.window.showErrorMessage(`Sync failed: ${m.message}`);let c=o.window.createOutputChannel("Robot Code Sync");c.appendLine("Error:"),c.appendLine(m.message),f&&(c.appendLine(`
Stderr:`),c.appendLine(f)),c.appendLine(`
Command:`),c.appendLine(i.replace(g,"***")),c.show(),l(m);return}if(o.window.showInformationMessage(`\u2705 ${e} synced to robot successfully!`),_){let c=o.window.createOutputChannel("Robot Code Sync");c.appendLine(`Sync completed for ${e}:`),c.appendLine(_)}a()})}))}function B(s){console.log("Robot Code Sync extension is now active!");let t=o.window.createStatusBarItem(o.StatusBarAlignment.Right,100);t.command="robot-code-sync.syncNav2WsToRobot",t.text="$(cloud-upload) Sync to Robot",t.tooltip="Click to sync code to robot",o.workspace.getConfiguration("robotCodeSync").get("showStatusBar",!0)&&t.show(),s.subscriptions.push(t),s.subscriptions.push(o.commands.registerCommand("robot-code-sync.syncNav2WsToRobot",()=>b("rom_nav2_ws_sourcePath","rom_nav2_ws_destinationPath","nav2_ws"))),s.subscriptions.push(o.commands.registerCommand("robot-code-sync.syncDataToRobot",()=>b("data_sourcePath","data_destinationPath","~/data"))),s.subscriptions.push(o.commands.registerCommand("robot-code-sync.syncMytmuxToRobot",()=>b("mytmux_sourcePath","mytmux_destinationPath","mytmux"))),s.subscriptions.push(o.commands.registerCommand("robot-code-sync.syncSdkWsToRobot",()=>b("rom_sdk_ws_sourcePath","rom_sdk_ws_destinationPath","rom_sdk_ws"))),s.subscriptions.push(o.commands.registerCommand("robot-code-sync.syncDriversWsToRobot",()=>b("rom_drivers_ws_sourcePath","rom_drivers_ws_destinationPath","rom_drivers_ws"))),s.subscriptions.push(o.commands.registerCommand("robot-code-sync.syncThirdpartyDriversWsToRobot",()=>b("thirdparty_drivers_ws_sourcePath","thirdparty_drivers_ws_destinationPath","thirdparty_drivers_ws"))),s.subscriptions.push(o.commands.registerCommand("robot-code-sync.syncAllToRobot",()=>b("all_sourcePath","all_destinationPath","All")));let r=(u,i)=>o.commands.registerCommand(`robot-code-sync.build${u}`,async()=>{let d=o.workspace.getConfiguration("robotCodeSync"),a=d.get("robotHost","robot@192.168.1.100"),l=d.get("robotPassword",""),m=o.window.createTerminal({name:`Build ${i}`,shellPath:"/bin/bash"});l?m.sendText(`sshpass -p '${l}' ssh -t ${a} "cd ~/${i} && colcon build"`):m.sendText(`ssh -t ${a} "cd ~/${i} && colcon build"`),m.show()}),n=r("RomSdkWs","rom_sdk_ws"),p=r("RomNav2Ws","rom_nav2_ws"),h=r("RomDriversWs","rom_drivers_ws"),g=r("ThirdpartyDriversWs","thirdparty_drivers_ws"),v=o.commands.registerCommand("robot-code-sync.openSSH",async()=>{let u=o.workspace.getConfiguration("robotCodeSync"),i=u.get("robotHost","robot@192.168.1.100"),d=u.get("robotPassword",""),a=o.window.createTerminal({name:`SSH: ${i}`,shellPath:"/bin/bash"});d?a.sendText(`sshpass -p '${d}' ssh ${i}`):a.sendText(`ssh ${i}`),a.show()}),y=o.commands.registerCommand("robot-code-sync.openSettings",()=>{o.commands.executeCommand("workbench.action.openSettings","@ext:rom-robotics-llc.robot-code-sync")});s.subscriptions.push(n),s.subscriptions.push(p),s.subscriptions.push(h),s.subscriptions.push(g),s.subscriptions.push(v),s.subscriptions.push(y)}function D(){}0&&(module.exports={activate,deactivate});
