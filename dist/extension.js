"use strict";var x=Object.create;var _=Object.defineProperty;var A=Object.getOwnPropertyDescriptor;var R=Object.getOwnPropertyNames;var k=Object.getPrototypeOf,I=Object.prototype.hasOwnProperty;var M=(s,e)=>{for(var d in e)_(s,d,{get:e[d],enumerable:!0})},P=(s,e,d,m)=>{if(e&&typeof e=="object"||typeof e=="function")for(let c of R(e))!I.call(s,c)&&c!==d&&_(s,c,{get:()=>e[c],enumerable:!(m=A(e,c))||m.enumerable});return s};var S=(s,e,d)=>(d=s!=null?x(k(s)):{},P(e||!s||!s.__esModule?_(d,"default",{value:s,enumerable:!0}):d,s)),H=s=>P(_({},"__esModule",{value:!0}),s);var L={};M(L,{activate:()=>G,deactivate:()=>W});module.exports=H(L);var o=S(require("vscode")),T=require("child_process"),w=S(require("fs"));async function u(s,e,d){let m=o.workspace.getConfiguration("robotCodeSync"),c=m.get(s,""),b=m.get(e,""),h=m.get("robotHost","robot@192.168.1.100"),l=m.get("robotPassword",""),f=m.get("excludePatterns",[".git","node_modules"]);if(!w.existsSync(c)){o.window.showErrorMessage(`Source path does not exist: ${c}`);return}if(await o.window.showInformationMessage(`Sync ${d}
From: ${c}
To: ${h}:${b}`,"Yes","No")!=="Yes")return;c.endsWith("/")||(c+="/");let v=f.map(y=>`--exclude='${y}'`).join(" "),p;l?p=`sshpass -p '${l}' rsync -avz --delete ${v} "${c}" ${h}:"${b}"`:p=`rsync -avz --delete ${v} "${c}" ${h}:"${b}"`,o.window.withProgress({location:o.ProgressLocation.Notification,title:`Syncing ${d} to robot...`,cancellable:!1},async y=>new Promise((C,a)=>{(0,T.exec)(p,{maxBuffer:1024*1024*10},(n,t,r)=>{if(n){o.window.showErrorMessage(`Sync failed: ${n.message}`);let i=o.window.createOutputChannel("Robot Code Sync");i.appendLine("Error:"),i.appendLine(n.message),r&&(i.appendLine(`
Stderr:`),i.appendLine(r)),i.appendLine(`
Command:`),i.appendLine(p.replace(l,"***")),i.show(),a(n);return}if(o.window.showInformationMessage(`\u2705 ${d} synced to robot successfully!`),t){let i=o.window.createOutputChannel("Robot Code Sync");i.appendLine(`Sync completed for ${d}:`),i.appendLine(t)}C()})}))}function G(s){console.log("Robot Code Sync extension is now active!");let e=o.window.createStatusBarItem(o.StatusBarAlignment.Right,100);e.command="robot-code-sync.syncNav2WsToRobot",e.text="$(cloud-upload) Sync to Robot",e.tooltip="Click to sync code to robot",o.workspace.getConfiguration("robotCodeSync").get("showStatusBar",!0)&&e.show(),s.subscriptions.push(e),s.subscriptions.push(o.commands.registerCommand("robot-code-sync.syncNav2WsToRobot",()=>u("rom_nav2_ws_sourcePath","rom_nav2_ws_destinationPath","nav2_ws"))),s.subscriptions.push(o.commands.registerCommand("robot-code-sync.syncDataToRobot",()=>u("data_sourcePath","data_destinationPath","~/data"))),s.subscriptions.push(o.commands.registerCommand("robot-code-sync.syncMytmuxToRobot",()=>u("mytmux_sourcePath","mytmux_destinationPath","mytmux"))),s.subscriptions.push(o.commands.registerCommand("robot-code-sync.syncSdkWsToRobot",()=>u("rom_sdk_ws_sourcePath","rom_sdk_ws_destinationPath","rom_sdk_ws"))),s.subscriptions.push(o.commands.registerCommand("robot-code-sync.syncDriversWsToRobot",()=>u("rom_drivers_ws_sourcePath","rom_drivers_ws_destinationPath","rom_drivers_ws"))),s.subscriptions.push(o.commands.registerCommand("robot-code-sync.syncThirdpartyDriversWsToRobot",()=>u("thirdparty_drivers_ws_sourcePath","thirdparty_drivers_ws_destinationPath","thirdparty_drivers_ws"))),s.subscriptions.push(o.commands.registerCommand("robot-code-sync.syncAllToRobot",()=>u("all_sourcePath","all_destinationPath","All")));let m=(a,n)=>o.commands.registerCommand(`robot-code-sync.build${a}`,async()=>{let t=o.workspace.getConfiguration("robotCodeSync"),r=t.get("robotHost","robot@192.168.1.100"),i=t.get("robotPassword",""),g=o.window.createTerminal({name:`Build ${n}`,shellPath:"/bin/bash"});i?g.sendText(`sshpass -p '${i}' ssh -t ${r} "cd ~/${n} && colcon build"`):g.sendText(`ssh -t ${r} "cd ~/${n} && colcon build"`),g.show()}),c=m("RomSdkWs","rom_sdk_ws"),b=m("RomNav2Ws","rom_nav2_ws"),h=m("RomDriversWs","rom_drivers_ws"),l=m("ThirdpartyDriversWs","thirdparty_drivers_ws"),f=o.commands.registerCommand("robot-code-sync.buildAll",async()=>{let a=o.workspace.getConfiguration("robotCodeSync"),n=a.get("robotHost","robot@192.168.1.100"),t=a.get("robotPassword",""),r=o.window.createTerminal({name:"Build All",shellPath:"/bin/bash"}),i="cd ~/rom_sdk_ws && colcon build && cd ~/rom_drivers_ws && colcon build && cd ~/rom_nav2_ws && colcon build";t?r.sendText(`sshpass -p '${t}' ssh -t ${n} "${i}"`):r.sendText(`ssh -t ${n} "${i}"`),r.show()}),$=o.commands.registerCommand("robot-code-sync.runGui",async()=>{let n=o.workspace.getConfiguration("robotCodeSync").get("appImagePath","/home/mr_robot/Desktop/Git/rom_robotics/data/app/rom_dynamics_multi_robots_gui-linux-linux-v0.0.1.AppImage");if(!w.existsSync(n)){o.window.showErrorMessage(`AppImage not found: ${n}`);return}let t=o.window.createTerminal({name:"ROM GUI",shellPath:"/bin/bash"});t.sendText(`chmod +x "${n}" && "${n}"`),t.show(),o.window.showInformationMessage("ROM GUI launched!")}),v=o.commands.registerCommand("robot-code-sync.runTuningApp",async()=>{let a=o.workspace.getConfiguration("robotCodeSync"),n=a.get("tuningAppPath","/home/mr_robot/data/app/tuning_app-linux-linux-v0.0.1.AppImage"),t=a.get("robotHost","robot@192.168.1.100"),r=a.get("robotPassword","");if(!w.existsSync(n)){o.window.showErrorMessage(`Tuning App not found: ${n}`);return}let i=t.includes("@")?t.split("@")[1]:t,g=o.window.createTerminal({name:"Tuning App",shellPath:"/bin/bash"});g.sendText(`chmod +x "${n}" && "${n}" -i ${i} -p "${r}"`),g.show(),o.window.showInformationMessage("Tuning App launched!")}),p=o.commands.registerCommand("robot-code-sync.runGroot",async()=>{let n=o.workspace.getConfiguration("robotCodeSync").get("grootAppPath","/home/mr_robot/data/app/Groot-1.0.0-x86_64.AppImage"),t=n.substring(0,n.lastIndexOf("/"));if(!w.existsSync(t)){o.window.showErrorMessage(`Groot directory not found: ${t}`);return}let r=o.window.createTerminal({name:"Groot",shellPath:"/bin/bash"});r.sendText(`nautilus "${t}"`),r.show(),o.window.showInformationMessage(`Opened Groot directory: ${t}`)}),y=o.commands.registerCommand("robot-code-sync.openSSH",async()=>{let a=o.workspace.getConfiguration("robotCodeSync"),n=a.get("robotHost","robot@192.168.1.100"),t=a.get("robotPassword",""),r=o.window.createTerminal({name:`SSH: ${n}`,shellPath:"/bin/bash"});t?r.sendText(`sshpass -p '${t}' ssh ${n}`):r.sendText(`ssh ${n}`),r.show()}),C=o.commands.registerCommand("robot-code-sync.openSettings",()=>{o.commands.executeCommand("workbench.action.openSettings","@ext:rom-robotics-llc.robot-code-sync")});s.subscriptions.push(c),s.subscriptions.push(b),s.subscriptions.push(h),s.subscriptions.push(l),s.subscriptions.push(f),s.subscriptions.push($),s.subscriptions.push(v),s.subscriptions.push(p),s.subscriptions.push(y),s.subscriptions.push(C)}function W(){}0&&(module.exports={activate,deactivate});
